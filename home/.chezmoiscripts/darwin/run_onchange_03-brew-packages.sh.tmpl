#!/bin/bash
#
# Install/sync packages from Brewfile
# Re-runs when Brewfile content changes
#
# Brewfile hash: {{ include "Brewfile" | sha256sum }}

{{ if ne .chezmoi.os "darwin" }}
exit 0
{{ end }}

set -eufo pipefail

echo "[brew-packages]"

# Homebrew 환경 변수 로드
{{ $homebrewPrefix := .homebrewPrefix }}
eval "$({{ $homebrewPrefix }}/bin/brew shellenv)"

# Brewfile 기반 패키지 일괄 설치/동기화 (zerobrew 우선, 실패 시 Homebrew 폴백)
if command -v zb &>/dev/null; then
    zb bundle --file="{{ .chezmoi.sourceDir }}/Brewfile" || brew bundle --file="{{ .chezmoi.sourceDir }}/Brewfile"
else
    brew bundle --file="{{ .chezmoi.sourceDir }}/Brewfile"
fi

echo "[brew-packages] done"
