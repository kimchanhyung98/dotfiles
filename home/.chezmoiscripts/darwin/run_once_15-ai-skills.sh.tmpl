#!/bin/bash
#
# AI Skills: deploy shared skills to Claude, Codex, Copilot, OpenCode global paths
# Runs once on first setup

{{ if ne .chezmoi.os "darwin" }}
exit 0
{{ end }}

set -eufo pipefail

echo "=== AI Skills ==="

# Skill target directories (4 tools)
SKILL_DIRS=(
    "$HOME/.claude/skills"
    "$HOME/.agents/skills"
    "$HOME/.copilot/skills"
    "$HOME/.config/opencode/skills"
)

# Ensure all skill directories exist
for dir in "${SKILL_DIRS[@]}"; do
    mkdir -p "$dir"
    echo "Skill directory ensured: $dir"
done

# Deploy skills from awesome-agent-skills
AWESOME_SKILLS_REPO="https://github.com/VoltAgent/awesome-agent-skills.git"
AWESOME_SKILLS_DIR="$HOME/.local/share/awesome-agent-skills"

if [ ! -d "$AWESOME_SKILLS_DIR" ]; then
    echo "Cloning awesome-agent-skills..."
    git clone --depth 1 "$AWESOME_SKILLS_REPO" "$AWESOME_SKILLS_DIR"
fi

# Selected skills to deploy
SELECTED_SKILLS=(
    # Add skill directory names from awesome-agent-skills here
)

for skill in "${SELECTED_SKILLS[@]+"${SELECTED_SKILLS[@]}"}"; do
    if [ -d "$AWESOME_SKILLS_DIR/$skill" ]; then
        for dir in "${SKILL_DIRS[@]}"; do
            if [ ! -d "$dir/$skill" ]; then
                cp -r "$AWESOME_SKILLS_DIR/$skill" "$dir/$skill"
                echo "  Deployed: $skill → $dir"
            fi
        done
    fi
done

# humanizer is deployed via .chezmoiexternal.toml to Claude and Codex paths
# Symlink to remaining paths
HUMANIZER_SRC="$HOME/.claude/skills/humanizer"
if [ -d "$HUMANIZER_SRC" ]; then
    for dir in "$HOME/.copilot/skills" "$HOME/.config/opencode/skills"; do
        if [ ! -e "$dir/humanizer" ]; then
            ln -sf "$HUMANIZER_SRC" "$dir/humanizer"
            echo "  Linked humanizer → $dir"
        fi
    done
fi

echo "=== AI Skills complete ==="
