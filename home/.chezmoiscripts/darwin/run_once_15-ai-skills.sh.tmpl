#!/bin/bash
#
# AI Skills: deploy shared skills to Claude, Codex, Copilot, OpenCode global paths
# Runs once on first setup

{{ if ne .chezmoi.os "darwin" }}
exit 0
{{ end }}

set -eufo pipefail

echo "[ai-skills]"

# 스킬 대상 디렉토리 (4개 AI 도구)
# - Claude, Codex, Copilot, OpenCode 각각의 스킬 경로
SKILL_DIRS=(
    "$HOME/.claude/skills"
    "$HOME/.agents/skills"
    "$HOME/.copilot/skills"
    "$HOME/.config/opencode/skills"
)

# 스킬 디렉토리 생성
for dir in "${SKILL_DIRS[@]}"; do
    mkdir -p "$dir"
    echo "Skill directory ensured: $dir"
done

# awesome-agent-skills 저장소에서 스킬 배포
# - 커뮤니티 공유 스킬 모음 클론
AWESOME_SKILLS_REPO="https://github.com/VoltAgent/awesome-agent-skills.git"
AWESOME_SKILLS_DIR="$HOME/.local/share/awesome-agent-skills"

if [ ! -d "$AWESOME_SKILLS_DIR" ]; then
    echo "Cloning awesome-agent-skills..."
    git clone --depth 1 "$AWESOME_SKILLS_REPO" "$AWESOME_SKILLS_DIR"
fi

# 배포할 스킬 목록
SELECTED_SKILLS=(
    # Add skill directory names from awesome-agent-skills here
)

# - 선택된 스킬을 4개 AI 도구 경로에 복사
for skill in "${SELECTED_SKILLS[@]+"${SELECTED_SKILLS[@]}"}"; do
    if [ -d "$AWESOME_SKILLS_DIR/$skill" ]; then
        for dir in "${SKILL_DIRS[@]}"; do
            if [ ! -d "$dir/$skill" ]; then
                cp -r "$AWESOME_SKILLS_DIR/$skill" "$dir/$skill"
                echo "  Deployed: $skill → $dir"
            fi
        done
    fi
done

# humanizer 스킬 심볼릭 링크
# - .chezmoiexternal.toml로 Claude/Codex에 배포된 humanizer를 나머지 경로에 링크
HUMANIZER_SRC="$HOME/.claude/skills/humanizer"
if [ -d "$HUMANIZER_SRC" ]; then
    for dir in "$HOME/.copilot/skills" "$HOME/.config/opencode/skills"; do
        if [ ! -e "$dir/humanizer" ]; then
            ln -sf "$HUMANIZER_SRC" "$dir/humanizer"
            echo "  Linked humanizer → $dir"
        fi
    done
fi

echo "[ai-skills] done"
