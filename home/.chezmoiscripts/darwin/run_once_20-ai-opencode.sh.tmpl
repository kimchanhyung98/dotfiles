#!/bin/bash
#
# AI OpenCode: OpenCode, oh-my-opencode, superpowers (copy)

{{ if ne .chezmoi.os "darwin" }}
exit 0
{{ end }}

set -eufo pipefail

echo "[ai-opencode]"

# OpenCode
# - 오픈소스 터미널 AI 코딩 도우미
if ! command -v opencode &>/dev/null; then
    echo "Installing OpenCode..."
    npm install -g opencode-ai || echo "[ai-opencode][warning] OpenCode installation failed"
else
    echo "OpenCode: already installed ($(opencode --version 2>/dev/null || echo 'installed'))"
fi

# oh-my-opencode
# - OpenCode 멀티 에이전트 오케스트레이션 (에이전트, 훅, MCP 통합)
if ! command -v oh-my-opencode &>/dev/null; then
    echo "Installing oh-my-opencode..."
    npm install -g oh-my-opencode || echo "[ai-opencode][warning] oh-my-opencode installation failed"
else
    echo "oh-my-opencode: already installed"
fi

# superpowers for OpenCode
# - ~/superpowers에서 OpenCode 플러그인 경로로 복사 (개별 커스텀 가능)
OPENCODE_PLUGINS_DIR="$HOME/.config/opencode/plugins/superpowers"

if [ -d "$HOME/superpowers/skills" ] && [ ! -d "$OPENCODE_PLUGINS_DIR" ]; then
    echo "Copying superpowers to OpenCode plugins..."
    mkdir -p "$(dirname "$OPENCODE_PLUGINS_DIR")"
    cp -r "$HOME/superpowers/skills" "$OPENCODE_PLUGINS_DIR"
fi

echo "[ai-opencode] done"
