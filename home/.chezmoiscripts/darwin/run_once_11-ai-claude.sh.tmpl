#!/bin/bash
#
# AI Claude: SuperClaude, peon-ping, Augment Context Engine MCP

{{ if ne .chezmoi.os "darwin" }}
exit 0
{{ end }}

set -eufo pipefail

echo "[ai-claude]"

# SuperClaude
# - Claude Code 확장 프레임워크 (페르소나, 명령어, 플래그 시스템)
if ! command -v superclaude &>/dev/null; then
    echo "Installing SuperClaude..."
    pipx install superclaude || echo "[ai-claude][warning] SuperClaude installation failed"
    SuperClaude install --force --yes || true
else
    echo "SuperClaude: already installed"
fi

# peon-ping
# - 작업 완료 알림 사운드 (임시파일 다운로드 후 실행)
if [ ! -d "$HOME/.claude/hooks/peon-ping" ]; then
    echo "Installing peon-ping..."
    installer=$(mktemp)
    if curl -fsSL https://raw.githubusercontent.com/PeonPing/peon-ping/main/install.sh -o "$installer" 2>/dev/null; then
        bash "$installer" --packs=hal_2001,protoss,sc_marine,sc_scv || echo "[ai-claude][warning] peon-ping installation failed"
        rm -f "$installer"
    else
        rm -f "$installer"
        echo "[ai-claude][warning] peon-ping download failed"
    fi
else
    echo "peon-ping: already installed"
fi

# Augment Context Engine MCP
# - claude mcp add-json으로 사용자 범위 MCP 서버 등록 (auggie CLI 필요)
if command -v claude &>/dev/null && command -v auggie &>/dev/null; then
    if ! claude mcp list 2>/dev/null | grep -q "auggie-mcp"; then
        echo "Registering Augment Context Engine MCP..."
        claude mcp add-json auggie-mcp --scope user '{"type":"stdio","command":"auggie","args":["--mcp","--mcp-auto-workspace"]}' || echo "[ai-claude][warning] Augment MCP registration failed"
    else
        echo "Augment Context Engine MCP: already registered"
    fi
else
    echo "[ai-claude][warning] claude or auggie not found, skipping Augment MCP registration"
fi

echo "[ai-claude] done"
