#!/bin/bash
#
# Install Rosetta 2 for Apple Silicon Macs
# Runs once on first setup

{{ if ne .chezmoi.os "darwin" }}
exit 0
{{ end }}

{{ if not .isAppleSilicon }}
exit 0
{{ end }}

set -eufo pipefail

echo "Checking Rosetta 2 installation..."

if ! /usr/bin/pgrep -q oahd; then
    echo "Installing Rosetta 2..."
    /usr/sbin/softwareupdate --install-rosetta --agree-to-license
else
    echo "Rosetta 2 is already installed."
fi
