#!/bin/bash
#
# System baseline: default editor, paths, basic security
# Re-applies when this script changes

{{ if ne .chezmoi.os "linux" }}
exit 0
{{ end }}

set -eufo pipefail

echo "[system-baseline]"

PROFILE_FILE="$HOME/.profile"
touch "$PROFILE_FILE"

# 중복 방지하며 ~/.profile에 설정 추가하는 헬퍼 함수
append_if_missing() {
    local line="$1"
    if ! grep -Fqx "$line" "$PROFILE_FILE" 2>/dev/null; then
        echo "$line" >> "$PROFILE_FILE"
    fi
}

# 기본 에디터
# - vim을 EDITOR/VISUAL 환경 변수로 설정
if command -v vim &>/dev/null; then
    if ! grep -Fq 'export EDITOR="vim"' "$PROFILE_FILE" 2>/dev/null; then
        echo "Setting vim as default editor..."
        append_if_missing 'export EDITOR="vim"'
        append_if_missing 'export VISUAL="vim"'
    fi
fi

# PATH 설정
# - ~/.local/bin을 PATH에 추가 (사용자 로컬 바이너리 경로)
mkdir -p "$HOME/.local/bin"
if ! grep -Fq 'export PATH="$HOME/.local/bin:$PATH"' "$PROFILE_FILE" 2>/dev/null; then
    append_if_missing 'export PATH="$HOME/.local/bin:$PATH"'
fi

echo "[system-baseline] done"
