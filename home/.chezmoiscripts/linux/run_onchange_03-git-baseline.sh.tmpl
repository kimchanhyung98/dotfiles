#!/bin/bash
#
# Git baseline: user config, SSH basics
# Re-applies when this script changes

{{ if ne .chezmoi.os "linux" }}
exit 0
{{ end }}

set -eufo pipefail

echo "[git-baseline]"

# Git 사용자 설정 확인
# - dot_gitconfig.tmpl에서 설정됨, 여기서는 확인만
if git config --global user.name &>/dev/null; then
    echo "Git user: $(git config --global user.name) <$(git config --global user.email)>"
else
    echo "Warning: Git user not configured. Check ~/.gitconfig"
fi

# SSH 키 기본 설정
# - ~/.ssh 디렉토리 생성 및 권한 설정
SSH_DIR="$HOME/.ssh"
if [ ! -d "$SSH_DIR" ]; then
    echo "Creating SSH directory..."
    mkdir -p "$SSH_DIR"
    chmod 700 "$SSH_DIR"
fi

# - Ed25519 SSH 키 존재 여부 확인
if [ ! -f "$SSH_DIR/id_ed25519" ]; then
    echo "Note: No SSH key found. Generate one with:"
    echo '  ssh-keygen -t ed25519 -C {{ .email | quote }}'
fi

echo "[git-baseline] done"
