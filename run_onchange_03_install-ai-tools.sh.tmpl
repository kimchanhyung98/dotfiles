#!/bin/bash

set -e

echo "03. installing AI tools"

# Install claude cli
if command -v claude &> /dev/null; then
    echo "[claude-cli][update] start"
    npm update -g @anthropic-ai/claude-code || true
    echo "[claude-cli][update] done"
else
    echo "[claude-cli][install] start"
    npm install -g @anthropic-ai/claude-code || true
    echo "[claude-cli][install] done"
fi
claude login || true

# Install pipx
echo "[pipx][install] start"
pipx ensurepath
export PATH="$HOME/.local/bin:$PATH"
source "$HOME/.zshrc"
echo "[pipx][install] done"

# Install SuperClaude
if command -v SuperClaude &> /dev/null; then
    echo "[superclaude][upgrade] start"
    pipx upgrade SuperClaude || true
    echo "[superclaude][upgrade] done"
else
    echo "[superclaude][install] dependencies"
    pipx install SuperClaude || true
    SuperClaude install --force --yes || true
    echo "[superclaude][install] done"
fi

# Install SuperGemini
if command -v SuperGemini &> /dev/null; then
    echo "[supergemini][upgrade] start"
    pipx upgrade SuperGemini || true
    echo "[supergemini][upgrade] done"
else
    echo "[supergemini][install] dependencies"
    pipx install SuperGemini || true
    SuperGemini install --force --yes || true
    echo "[supergemini][install] done"
fi

# Install bun
if command -v bun &> /dev/null; then
    echo "[bun][update] start"
    bun update
    echo "[bun][update] done"
else
    echo "[bun][install] start"
    curl -fsSL https://bun.sh/install | bash
    # Ensure bun PATH for current session
    export PATH="$HOME/.bun/bin:$PATH"
    source "$HOME/.zshrc"
    echo "[bun][install] done"
fi

# Install opcode (claudia)
OPCODE_DIR="$HOME/opcode"
if [ ! -d "$OPCODE_DIR" ]; then
    echo "[opcode][install] clone repository"
    git clone https://github.com/getAsterisk/opcode.git "$OPCODE_DIR"

    echo "[opcode][install] install dependencies"
    cd "$OPCODE_DIR"
    bun install
    bun run tauri build
    echo "[opcode][install] setup completed"
else
    echo "[opcode][update] repository"
    cd "$OPCODE_DIR"
    git pull --ff-only || true

    echo "[opcode][update] dependencies"
    bun install
    bun run tauri build
    echo "[opcode][update] setup completed"
fi

# Install auggie (augment cli)
if command -v auggie &> /dev/null; then
    echo "[auggie][update] start"
    npm update -g @augmentcode/auggie || true
    echo "[auggie][update] done"
else
    echo "[auggie][install] start"
    npm install -g @augmentcode/auggie || true
    echo "[auggie][install] done"
fi

echo "03. AI tools installation completed"
