#!/bin/bash

set -e

echo "03. Installing AI tools..."

# Install Bun (JavaScript runtime and package manager)
if ! command -v bun &> /dev/null; then
    echo "Installing Bun..."
    curl -fsSL https://bun.sh/install | bash
    
    # Add bun to PATH for current session
    export PATH="$HOME/.bun/bin:$PATH"
    source "$HOME/.zshrc"

    echo "Bun installed successfully"
else
    echo "Bun already installed"
fi

# Install Augment AI tool (auggie)
if ! command -v auggie &> /dev/null; then
    echo "Installing Augment AI tool (auggie)..."
    npm install -g @augmentcode/auggie
    echo "Auggie installed successfully"
else
    echo "Auggie already installed"
fi

# Install Claude CLI and SuperClaude Framework
SUPERCLAUDE_DIR="$HOME/SuperClaude"
if [ ! -d "$SUPERCLAUDE_DIR" ]; then
    echo "Installing Claude CLI..."
    npm install -g @anthropic-ai/claude-code
    # curl -fsSL https://claude.ai/install.sh | bash

    echo "Installing SuperClaude Framework dependencies..."
    git clone https://github.com/SuperClaude-Org/SuperClaude_Framework.git "$SUPERCLAUDE_DIR"
    cd "$SUPERCLAUDE_DIR"
    uv sync

    echo "Installing SuperClaude with developer profile..."
    mkdir -p ~/.claude
    touch ~/.claude/CLAUDE.md
    python3 -m SuperClaude install --profile developer --yes

    echo "SuperClaude Framework setup completed"
else
    echo "SuperClaude Framework already exists at $SUPERCLAUDE_DIR"
    echo "Updating SuperClaude Framework..."
    cd "$SUPERCLAUDE_DIR"
    git pull origin master
    uv sync

    echo "Reinstalling SuperClaude with developer profile..."
    mkdir -p ~/.claude
    touch ~/.claude/CLAUDE.md
    echo -e "y\ny" | python3 -m SuperClaude install --profile developer
fi

# Install Claudia
CLAUDIA_DIR="$HOME/claudia"
if [ ! -d "$CLAUDIA_DIR" ]; then
    echo "Cloning Claudia repository..."
    git clone https://github.com/getAsterisk/claudia.git "$CLAUDIA_DIR"
    
    echo "Installing Claudia dependencies..."
    cd "$CLAUDIA_DIR"
    bun install
    
    echo "Claudia setup completed"
else
    echo "Claudia already exists at $CLAUDIA_DIR"
    echo "Updating Claudia..."
    cd "$CLAUDIA_DIR"
    git pull origin main
    bun install
fi

echo "AI tools installation completed"
echo "Please restart your terminal or run 'source ~/.zshrc' to update your PATH"
