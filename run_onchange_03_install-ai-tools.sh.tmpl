#!/bin/bash

set -e

echo "03. Installing AI tools..."

# Install Bun (JavaScript runtime and package manager)
if ! command -v bun &> /dev/null; then
    echo "Installing Bun..."
    curl -fsSL https://bun.sh/install | bash
    
    # Add bun to PATH for current session
    export PATH="$HOME/.bun/bin:$PATH"
    source "$HOME/.zshrc"

    echo "Bun installed successfully"
else
    echo "Bun already installed"
fi

# Install Augment AI tool (auggie)
if ! command -v auggie &> /dev/null; then
    echo "Installing Augment AI tool (auggie)..."
    npm install -g @augmentcode/auggie
    echo "Auggie installed successfully"
else
    echo "Auggie already installed"
fi

# Install Claude CLI and SuperClaude Framework
if ! command -v SuperClaude &> /dev/null; then
    echo "Installing pipx..."
    pipx ensurepath
    export PATH="$HOME/.local/bin:$PATH"

    echo "Installing Claude CLI..."
    npm install -g @anthropic-ai/claude-code
    claude login

    echo "Installing SuperClaude Framework dependencies..."
    pipx install SuperClaude
    echo -e "\n\n\n\n" | SuperClaude install --force --yes

    echo "Installing SuperGemini Framework dependencies..."
    pipx install SuperGemini
    echo -e "\n" | SuperGemini install --force --yes

    echo "SuperClaude Framework setup completed"
else
    pipx upgrade SuperClaude
    echo "Updating SuperClaude Framework..."
fi

# Install Claudia
CLAUDIA_DIR="$HOME/claudia"
if [ ! -d "$CLAUDIA_DIR" ]; then
    echo "Cloning Claudia repository..."
    git clone https://github.com/getAsterisk/claudia.git "$CLAUDIA_DIR"
    
    echo "Installing Claudia dependencies..."
    cd "$CLAUDIA_DIR"
    bun install
    
    echo "Claudia setup completed"
else
    echo "Claudia already exists at $CLAUDIA_DIR"
    echo "Updating Claudia..."
    cd "$CLAUDIA_DIR"
    git pull origin main
    bun install
fi

echo "AI tools installation completed"
echo "Please restart your terminal or run 'source ~/.zshrc' to update your PATH"
